---
title: "testis_benchmark_plots"
author: "BH"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r packages}

if (!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, readxl, ggplot2, ggsci, ggthemes, vroom, readr, tidyverse, DWLS, stringr, Metrics, quadprog)

theme_set(theme_few() + theme(text = element_text(size=28, family="Myriad Pro")))

```


Load in the testis objects
```{r objects}

testis_results <- readRDS("~/OneDrive - UW/data for deconv/Paper revision materials/brad_updated_code/testis_results.rds")

all_testis_sames <- testis_results$sames %>%
  mutate(imp = if_else(imp == "noIMP", "No Imputation", imp), imp = factor(imp, levels = c("No Imputation", "ALRA", "MAGIC", "SAVER")))

all_testis_inter <- testis_results$inter %>%
  mutate(imp = if_else(imp == "noIMP", "No Imputation", imp), imp = factor(imp, levels = c("No Imputation", "ALRA", "MAGIC", "SAVER")))


```

#INTRA

SAMES plotting - DWLS
```{r dwls-sames}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


dwls <- ggplot(data=all_testis_sames%>% filter(method== 'dwls'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks, limits=c(0, 1)) +  
  scale_y_continuous(breaks=ticks, limits=c(0, 1)) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) 

dwls

ggsave(dwls, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_sames/testis-sames_dwls.png", width = 12, height=9, units = 'in', bg = 'white')

```

SAMES plotting - OLS
```{r ols-sames}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


ols <- ggplot(data=all_testis_sames%>% filter(method== 'ols'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks, limits=c(0, 1)) +  
  scale_y_continuous(breaks=ticks, limits=c(0, 1)) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) 

ols

ggsave(ols, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_sames/testis-sames_ols.png", width = 12, height=9, units = 'in', bg = 'white')

```

SAMES plotting - SVR
```{r SVR-sames}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


svr <- ggplot(data=all_testis_sames%>% filter(method== 'SVR'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks, limits=c(0, 1)) +  
  scale_y_continuous(breaks=ticks, limits=c(0, 1)) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) 

svr

ggsave(svr, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_sames/testis-sames_SVR.png", width = 12, height=9, units = 'in', bg = 'white')

```

SAMES plotting - CB
```{r CB-sames}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


cb <- ggplot(data=all_testis_sames%>% filter(method== 'cb'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks, limits=c(0, 1)) +  
  scale_y_continuous(breaks=ticks, limits=c(0, 1)) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) 

cb

ggsave(cb, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_sames/testis-sames_CB.png", width = 12, height=9, units = 'in', bg = 'white')

```

SAMES plotting - nnls
```{r nnls-sames}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


nnls <- ggplot(data=all_testis_sames%>% filter(method== 'nnls'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks, limits=c(0, 1)) +  
  scale_y_continuous(breaks=ticks, limits=c(0, 1)) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) 

nnls

ggsave(nnls, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_sames/testis-sames_NNLS.png", width = 4, height=9, units = 'in', bg = 'white')

```

SAMES plotting - MUSIC
```{r music-sames}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


music <- ggplot(data=all_testis_sames%>% filter(method== 'music'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks, limits=c(0, 1)) +  
  scale_y_continuous(breaks=ticks, limits=c(0, 1)) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) 

music

ggsave(music, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_sames/testis-sames_music.png", width = 4, height=9, units = 'in', bg = 'white')

```






#INTER


inter plotting - DWLS
```{r dwls-inter}

ticks <- c( 0.1,0.25,0.50,0.75,0.90)


dwls <- ggplot(data=all_testis_inter%>% filter(method== 'dwls'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks) +  
  scale_y_continuous(breaks=ticks) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) + theme(panel.spacing = unit(1.5, "lines"))

dwls

ggsave(dwls, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_inter/testis-inter_dwls.png", width = 15, height=9, units = 'in', bg = 'white')

```

inter plotting - OLS
```{r ols-inter}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


ols <- ggplot(data=all_testis_inter%>% filter(method== 'ols'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks) +  
  scale_y_continuous(breaks=ticks) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) + theme(panel.spacing = unit(1.5, "lines"))

ols

ggsave(ols, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_inter/testis-inter_ols.png", width = 15, height=9, units = 'in', bg = 'white')

```

inter plotting - SVR
```{r SVR-inter}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


svr <- ggplot(data=all_testis_inter%>% filter(method== 'SVR'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks) +  
  scale_y_continuous(breaks=ticks) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) + theme(panel.spacing = unit(1.5, "lines"))

svr

ggsave(svr, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_inter/testis-inter_SVR.png", width = 15, height=9, units = 'in', bg = 'white')

```

inter plotting - CB
```{r CB-inter}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


cb <- ggplot(data=all_testis_inter%>% filter(method== 'cb'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks) +  
  scale_y_continuous(breaks=ticks) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) + theme(panel.spacing = unit(1.5, "lines"))

cb

ggsave(cb, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_inter/testis-inter_CB.png", width = 15, height=9, units = 'in', bg = 'white')

```

inter plotting - nnls
```{r nnls-inter}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


nnls <- ggplot(data=all_testis_inter%>% filter(method== 'nnls'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks) +  
  scale_y_continuous(breaks=ticks) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) 

nnls

ggsave(nnls, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_inter/testis-inter_NNLS.png", width = 4, height=9, units = 'in', bg = 'white')

```

inter plotting - MUSIC
```{r music-inter}

ticks <- c(0.1,0.25,0.50,0.75,0.90)


music <- ggplot(data=all_testis_inter%>% filter(method== 'music'), aes(x=pseudo, y=prediction, color =sig_ref)) +
  geom_point(size=4, shape='diamond', alpha = 0.65) + 
  stat_summary(fun = "mean", geom = "line", size = 1, alpha = 0.8) +  
  geom_abline(slope=1, linetype="dashed") +
  coord_fixed(ratio=1) +  
  scale_x_continuous(breaks=ticks) +  
  scale_y_continuous(breaks=ticks) +  
  ylab("Predicted Target Cell %") +
  xlab("Actual Target Cell %") +
  scale_color_d3(
    breaks=c('h112', 'h120' ,'h124' , 'md2' , 'md7'),
    labels=c("Adult-H", "Infant-120", "Infant-124", "Day 2-M","Day 7-M")) +    
  theme_minimal(base_size = 20, base_family = "Myriad Pro") +
  theme(legend.position="bottom", axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(color = "Single Cell Reference") +
  guides(color = guide_legend(title.position = "top"))+
  facet_wrap(~imp, nrow=1) 

music

ggsave(music, dpi = 600, filename = "~/OneDrive - UW/data for deconv/Paper revision materials/updated_figures/testis_inter/testis-inter_music.png", width = 4, height=9, units = 'in', bg = 'white')

```


